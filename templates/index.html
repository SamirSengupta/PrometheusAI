<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PrometheusAI</title>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='images/peacock-logo.png') }}">
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Highlight.js for code syntax highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/vs2015.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Russo+One&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background: #1e1e1e;
            color: #d4d4d4;
        }
        
        .chat-container {
            background: #1e1e1e;
            backdrop-filter: blur(10px);
            border-radius: 0.5rem;
            border: 1px solid #2d2d30;
        }
        
        .user-message div {
            background: #0e639c;
            color: #ffffff;
        }
        
        .ai-message div {
            background: #252526;
            color: #d4d4d4;
        }
        
        .sidebar {
            background: #252526;
            backdrop-filter: blur(10px);
            border-right: 1px solid #2d2d30;
        }
        
        .new-chat-btn {
            background: #2d2d30;
            border: 1px solid #3e3e42;
            color: #007acc;
            transition: all 0.2s;
        }
        
        .new-chat-btn:hover {
            background: #3e3e42;
            transform: translateY(-1px);
        }
        
        .google-btn {
            background: white;
            color: #1f2937;
            border: 1px solid #3e3e42;
            transition: all 0.2s;
            font-weight: 500;
        }
        
        .google-btn:hover {
            background: #f3f4f6;
            transform: translateY(-1px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        .user-profile {
            background: #2d2d30;
            border: 1px solid #3e3e42;
            border-radius: 0.5rem;
            padding: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid #007acc;
        }
        
        .logout-btn {
            background: rgba(239, 68, 68, 0.1);
            color: #f48771;
            border: 1px solid rgba(239, 68, 68, 0.2);
            padding: 0.25rem 0.75rem;
            border-radius: 0.375rem;
            font-size: 0.75rem;
            transition: all 0.2s;
        }
        
        .logout-btn:hover {
            background: rgba(239, 68, 68, 0.2);
        }
        
        .overflow-y-auto::-webkit-scrollbar {
            width: 8px;
        }
        
        .overflow-y-auto::-webkit-scrollbar-track {
            background: #1e1e1e;
        }
        
        .overflow-y-auto::-webkit-scrollbar-thumb {
            background: #3e3e42;
            border-radius: 4px;
        }
        
        .overflow-y-auto::-webkit-scrollbar-thumb:hover {
            background: #4e4e52;
        }
        
        .typing-indicator {
            display: inline-flex;
            gap: 4px;
        }
        
        .typing-indicator span {
            width: 8px;
            height: 8px;
            background: #007acc;
            border-radius: 50%;
            animation: bounce 1.4s infinite ease-in-out both;
        }
        
        .typing-indicator span:nth-child(1) { animation-delay: -0.32s; }
        .typing-indicator span:nth-child(2) { animation-delay: -0.16s; }
        
        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }
        
        .search-animation {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: rgba(0, 122, 204, 0.1);
            border: 1px solid rgba(0, 122, 204, 0.3);
            border-radius: 6px;
            margin: 8px 0;
        }
        
        .search-spinner {
            width: 16px;
            height: 16px;
            border: 2px solid rgba(0, 122, 204, 0.3);
            border-top-color: #007acc;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .search-pulse {
            display: inline-flex;
            gap: 3px;
        }
        
        .search-pulse span {
            width: 6px;
            height: 6px;
            background: #007acc;
            border-radius: 50%;
            animation: pulse 1.5s infinite ease-in-out;
        }
        
        .search-pulse span:nth-child(1) { animation-delay: 0s; }
        .search-pulse span:nth-child(2) { animation-delay: 0.2s; }
        .search-pulse span:nth-child(3) { animation-delay: 0.4s; }
        
        @keyframes pulse {
            0%, 100% { opacity: 0.3; transform: scale(0.8); }
            50% { opacity: 1; transform: scale(1.2); }
        }
        
        .search-text {
            color: #007acc;
            font-size: 0.875rem;
            font-weight: 500;
        }
        
        .chat-item {
            background: transparent;
            border: none;
            color: #d4d4d4;
            text-align: left;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .chat-item:hover {
            background: #2d2d30;
        }
        
        .chat-item.active {
            background: #094771;
            border-left: 3px solid #007acc;
        }
        
        .chat-item-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
            padding: 0.5rem;
            gap: 0.5rem;
        }
        
        .chat-item-title {
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            font-size: 0.875rem;
        }
        
        .chat-item-delete {
            opacity: 0;
            transition: opacity 0.2s;
            padding: 0.25rem;
            border-radius: 0.25rem;
        }
        
        .chat-item:hover .chat-item-delete {
            opacity: 1;
        }
        
        .chat-item-delete:hover {
            background: rgba(239, 68, 68, 0.2);
        }
        
        .input-container {
            background: #252526;
            border: 1px solid #3e3e42;
        }
        
        .logo-circular {
            border-radius: 50%;
            border: 2px solid #007acc;
            background: white;
            padding: 4px;
        }
        
        .code-block-container {
            position: relative;
            margin: 1rem 0;
            border-radius: 0.5rem;
            overflow: hidden;
            background: #1e1e1e;
            border: 1px solid #3e3e42;
        }
        
        .code-block-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 1rem;
            background: #252526;
            border-bottom: 1px solid #3e3e42;
        }
        
        .code-language {
            font-size: 0.875rem;
            font-weight: 500;
            color: #858585;
            text-transform: lowercase;
        }
        
        .copy-button {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.375rem 0.75rem;
            font-size: 0.875rem;
            background: rgba(0, 122, 204, 0.1);
            color: #007acc;
            border: 1px solid rgba(0, 122, 204, 0.3);
            border-radius: 0.375rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .copy-button:hover {
            background: rgba(0, 122, 204, 0.2);
            border-color: rgba(0, 122, 204, 0.5);
        }
        
        .copy-button.copied {
            background: rgba(34, 197, 94, 0.1);
            color: #4ade80;
            border-color: rgba(34, 197, 94, 0.3);
        }
        
        .code-block-body {
            padding: 1rem;
            overflow-x: auto;
            background: #1e1e1e;
        }
        
        .code-block-body pre {
            margin: 0;
            padding: 0;
            background: transparent;
        }
        
        .code-block-body code {
            font-family: 'Courier New', 'Monaco', monospace;
            font-size: 0.875rem;
            line-height: 1.6;
            background: transparent;
        }
        
        .code-block-body::-webkit-scrollbar {
            height: 8px;
        }
        
        .code-block-body::-webkit-scrollbar-track {
            background: #1e1e1e;
        }
        
        .code-block-body::-webkit-scrollbar-thumb {
            background: #3e3e42;
            border-radius: 4px;
        }
        
        .inline-code {
            background: #2d2d30;
            color: #ce9178;
            padding: 0.125rem 0.375rem;
            border-radius: 0.25rem;
            font-family: 'Courier New', 'Monaco', monospace;
            font-size: 0.875em;
        }
        
        .message-text {
            line-height: 1.7;
        }
        
        .message-text p {
            margin: 0.5rem 0;
        }
        
        .message-text p:first-child {
            margin-top: 0;
        }
        
        .message-text p:last-child {
            margin-bottom: 0;
        }
        
        .stop-btn {
            color: #ef4444;
        }
        
        .stop-btn:hover {
            color: #dc2626;
        }
        
        /* File Upload Styles */
        .upload-btn {
            color: #007acc;
            transition: all 0.2s;
        }
        
        .upload-btn:hover {
            color: #0098ff;
        }
        
        .file-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 0.75rem;
            background: rgba(0, 122, 204, 0.1);
            border: 1px solid rgba(0, 122, 204, 0.3);
            border-radius: 0.5rem;
            font-size: 0.875rem;
            color: #007acc;
            margin: 0.5rem 0;
        }
        
        .file-badge svg {
            width: 16px;
            height: 16px;
        }
        
        .file-badge-close {
            cursor: pointer;
            padding: 0.25rem;
            border-radius: 0.25rem;
            transition: all 0.2s;
        }
        
        .file-badge-close:hover {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }
        
        .processing-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 0.75rem;
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.3);
            border-radius: 0.5rem;
            font-size: 0.875rem;
            color: #4ade80;
            margin: 0.5rem 0;
        }
        
        .processing-spinner {
            width: 14px;
            height: 14px;
            border: 2px solid rgba(34, 197, 94, 0.3);
            border-top-color: #4ade80;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
    </style>
</head>
<body class="min-h-screen font-sans flex">

    <!-- Hidden File Input -->
    <input type="file" id="fileInput" accept=".pdf,.jpg,.jpeg,.png,.gif,.bmp" style="display: none;">

    <!-- Sidebar -->
    <div id="sidebar" class="sidebar fixed top-0 left-0 h-full flex flex-col p-2 space-y-2 w-64 transition-transform duration-300 ease-in-out z-40 transform md:translate-x-0 -translate-x-full">
        <button id="toggleSidebar" class="absolute top-4 -right-10 p-2 text-gray-400 hover:text-white bg-gray-800 rounded-r-md md:hidden">
            <svg id="sidebarIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5">
                <polyline points="15 18 9 12 15 6"></polyline>
            </svg>
        </button>
        
        <div class="flex items-center justify-center p-4">
            <img src="{{ url_for('static', filename='images/peacock-logo.png') }}"
                alt="PrometheusAI Logo" 
                class="logo-circular"
                style="width: 40px; height: 40px; object-fit: cover; border: 2px solid #007acc; background: #007acc;">
            <span class="text-xl font-bold ml-3" 
                style="font-family: 'Russo One', sans-serif; color: #007acc;">
                PrometheusAI
            </span>
        </div>
        
        <button id="newChatBtn" class="new-chat-btn flex items-center gap-3 p-3 rounded-md text-sm font-medium">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-4 h-4">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
            New chat
        </button>
        
        <div id="chatList" class="flex-col flex-1 overflow-y-auto space-y-1">
            <!-- Chat list items will be inserted here -->
        </div>
        
        <!-- Authentication Section -->
        <div id="authSection">
            <!-- Login Button (shown when not logged in) -->
            <button id="googleLoginBtn" class="google-btn flex items-center justify-center gap-2 p-2 rounded-md text-sm font-medium w-full">
                <svg width="18" height="18" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48">
                    <path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"/>
                    <path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"/>
                    <path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"/>
                    <path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"/>
                </svg>
                Sign in with Google
            </button>
            
            <!-- User Profile (shown when logged in) -->
            <div id="userProfile" class="user-profile hidden">
                <img id="userAvatar" src="" alt="User" class="user-avatar">
                <div class="flex-1 min-w-0">
                    <p id="userName" class="text-sm font-medium text-white truncate"></p>
                    <p id="userEmail" class="text-xs text-gray-400 truncate"></p>
                </div>
                <button id="logoutBtn" class="logout-btn">
                    Logout
                </button>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main id="mainContent" class="flex-1 flex flex-col h-screen transition-all duration-300 md:ml-64">
        <div id="chatContainer" class="flex-1 overflow-y-auto p-4 md:p-6">
            <div class="message-container max-w-4xl mx-auto">
                <!-- Welcome message -->
                <div id="welcomeMessage" class="text-center py-12">
                    <h1 class="text-3xl font-bold mb-4 text-blue-400">
                        Welcome to 
                        <span style="font-family: 'Russo One', sans-serif;">PrometheusAI</span>
                    </h1>
                    <p class="text-gray-300 mb-2">
                        Private, local AI assistant with web search â€” fast, secure, and customizable.
                    </p>
                    <p class="text-sm text-gray-400 mt-4">
                        ðŸ’¡ Upload PDFs or images to chat about documents!
                    </p>
                </div>
            </div>
        </div>
        
        <!-- File Upload Display Area -->
        <div id="uploadedFileDisplay" class="px-4 md:px-6 hidden">
            <div class="max-w-4xl mx-auto"></div>
        </div>
        
        <div class="p-4 md:p-6">
            <div class="max-w-4xl mx-auto">
                <div class="input-container flex items-center p-2 rounded-md">
                    <button id="uploadBtn" class="p-2 upload-btn transition-colors" title="Upload PDF or Image">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                            <polyline points="17 8 12 3 7 8"></polyline>
                            <line x1="12" y1="3" x2="12" y2="15"></line>
                        </svg>
                    </button>
                    <input id="chatInput" 
                           type="text" 
                           placeholder="Ask PrometheusAI anything. Upload documents to chat about them!" 
                           class="flex-1 bg-transparent outline-none px-4 text-sm">
                    <button id="sendBtn" class="p-2 text-blue-300 hover:text-white transition-colors">
                        <svg id="sendIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5">
                            <line x1="22" y1="2" x2="11" y2="13"></line>
                            <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                        </svg>
                        <svg id="stopIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5 hidden stop-btn">
                            <rect x="6" y="6" width="12" height="12" rx="2"></rect>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </main>

    <script src="{{ url_for('static', filename='js/chat.js') }}"></script>

</body>
</html>